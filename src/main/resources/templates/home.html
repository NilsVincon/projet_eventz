<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="output.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
          integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"/>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dela+Gothic+One&display=swap');

        nav {
            font-family: 'Dela Gothic One', sans-serif;
        }

        .container {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #today {
            float: left;
        }

        #today {
            position: absolute;
            top: 37px;
            left: 90px; /* Ajustez selon vos besoins */
        }

        #create {
            display: inline-block;
            padding: 10px 20px;
            background-color: #f0b8c5;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        #create:hover {
            background-color: #f7f8f7;
        }


        .event-image {
            width: 420px;
            height: 250px;
            border-radius: 5px;
            margin-top: 11px;
            margin-left: 10px;
            margin-bottom: 11px;
            object-fit: cover;
        }

        .policeperso {
            font-family: 'Dela Gothic One', sans-serif;
        }

        .transition-block {
            width: 80%; /* ajustez la largeur selon vos besoins */
            margin: 20px auto; /* espace entre les blocs et centrage horizontal */
            padding: 20px; /* ajout de marge intérieure pour le contenu */
            background-color: white; /* couleur de fond initiale */
            position: relative;
            transition: background-color 2s ease; /* durée et type de transition */
            border-radius: 10px; /* ajouter des coins arrondis */
            display: flex; /* utiliser flexbox */
            align-items: center; /* centrer verticalement */
        }

        .transition-block .content {
            display: flex; /* utiliser flexbox pour le contenu */
        }

        .transition-block img {
            width: 300px; /* ajustez la taille de l'image selon vos besoins */
            margin-right: 20px; /* espace entre l'image et le texte */
        }

        .transition-block .text {
            flex: 1; /* permet au texte de prendre autant d'espace que possible */
            color: whitesmoke;
        }

        .transition-block h2,
        .transition-block p {
            margin: 0;
            color: whitesmoke;
        }

        .filter-item {
            margin-right: 10px;
            padding: 20px;
            width: 172px;
            border-radius: 10px;
        }

        .bg-custom-color {
            background-color: rgba(167, 128, 213, 0.84);
        }

        .filter-item:last-child {
            margin-right: 0; /* Supprime l'espacement du dernier élément */
        }


        .footer {
            background-color: #f2f2f2;
            padding: 50px 0;
            font-size: 14px;
        }

        .footer .container {
            display: flex;
            flex-wrap: wrap;
        }

        .footer .footer-section {
            flex: 1;
            margin-right: 20px;
        }

        .footer h2 {
            font-size: 18px;
        }

        .footer ul {
            list-style: none;
            padding: 0;
        }

        .footer ul li {
            margin-bottom: 10px;
        }

        .footer .contact-form form {
            display: flex;
            flex-direction: column;
        }

        .footer .contact-form input,
        .footer .contact-form textarea {
            margin-bottom: 10px;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 20px;
        }

        body {
            background-image: url("/images/BG.png");
            background-size: cover;
            background-repeat: repeat-y;
            background-attachment: scroll;
            height: 100%;
            margin: 0;
        }


        body::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        body::-webkit-scrollbar-track {
            border-radius: 8px;
            background-color: #e7e7e7;
            border: 1px solid #cacaca;
        }

        body::-webkit-scrollbar-thumb {
            border-radius: 8px;
            background-color: rgba(192, 79, 218, 0.45);
        }

        body::-webkit-scrollbar-thumb:hover {
            background-color: rgba(159, 49, 176, 0.7);
        }

        .events-date {
            text-align: center;
            position: absolute;
            right: 30px;
            top: 30px;
            background-color: rgba(25, 47, 89, 0.9);
            color: #fff;
            padding: 12px 20px 8px 20px;
            text-transform: uppercase
        }

        .event-time li {
            display: inline-block;
            margin-right: 20px
        }

        .event-time li:last-child {
            margin-right: 0
        }

        .event-block {
            border-radius: 7px;
        }


        @media screen and (max-width: 1199px) {
            .event-date {
                padding: 10px 18px 6px 18px
            }
        }

        @media screen and (max-width: 575px) {
            .event-date {
                padding: 8px 15px 4px 15px
            }

            .events-date {
                padding: 10px 15px 6px 15px
            }
        }

        .position-relative {
            position: relative !important;
        }

        .margin-40px-bottom {
            margin-bottom: 40px;
        }

        .padding-60px-lr {
            padding-left: 60px;
            padding-right: 60px;
        }

        .margin-15px-bottom {
            margin-bottom: 15px;
        }

        .font-weight-500 {
            font-weight: 500;
        }

        .font-size22 {
            font-size: 22px;
        }

        .margin-10px-bottom {
            margin-bottom: 10px;
        }

        .margin-10px-right {
            margin-right: 10px;
        }

        /*****************************/
        /* MESSAGE BOX RELATED CLASS */
        /*          (START)          */
        /*****************************/
        .msgbox-area {
            font-size: inherit;
            max-height: 100%;
            position: fixed;
            bottom: 15px;
            left: 20px;
            right: 20px;
            z-index: 100;

        }

        .msgbox-box {
            font-size: inherit;
            color: #ffffff;
            margin: 0 0 1rem;
            display: flex;
            flex-direction: column;
            position: relative;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.65);
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            transition: opacity 256ms ease-in;
            background-color: gray;

        }

        .msgbox-box.msgbox-box-hide {
            opacity: 0;
        }

        .msgbox-box:last-child {
            margin: 0;
        }

        .msgbox-content {
            font-size: inherit;
            padding: 1.5rem;
            padding-bottom: 0.75rem;
            flex-shrink: 1;
        }

        .msgbox-command {
            padding: 1.5rem;
            padding-top: 0.75rem;
            display: flex;
        }

        .msgbox-close {
            color: #ffffff;
            font-size: inherit;
            text-decoration: none;
            margin: 0 10px;
            flex-grow: 0;
            flex-shrink: 0;
            position: relative;
            transition: color 64ms ease-out, text-shadow 64ms ease-out;
        }

        .msgbox-close:hover {
            color: #efefef;
            text-shadow: 0 0 4px #ffffff;
        }

        .msgbox-close:first-child {
            margin-left: auto;
        }

        .msgbox-close:last-child {
            margin-right: 0;
        }

        .transform-left {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .transform-right {
            transform: translateX(0);
            transition: transform 0.3s ease;
        }

        @media (min-width: 481px) and (max-width: 767px) {
            .msgbox-area {
                left: 80px;
                right: 80px;
            }
        }

        .icon-color {
            color: #dbc6c6;
        }

        @media (min-width: 768px) {
            .msgbox-area {
                width: 480px;
                height: 0;
                top: 15px;
                left: auto;
                right: 15px;
            }
        }

        .placeholder-custom::placeholder {
            color: rgba(92, 42, 145, 0.56);
        }

    </style>
    <title>Accueil</title>

</head>
<body class="h-screen overflow-y-auto">

<div class="msgbox-area" id="msgboxArea" th:attr="data-username=${username}"></div>
<div th:insert="~{fragments/navbar/navbar :: nav}"></div>


<div class="p-5 rounded-lg w-full max-w-2xl mx-auto z-50 justify-between flex">
    <form id="filterForm1" class="h-11/12">
        <div class="flex">
            <div class="flex flex-col items-center space-y-2 mr-6">
                <label class="policeperso text-red-50" for="cityFilter1">Ville</label>
                <input
                        class="w-28 bg-purple-800 bg-opacity-0 text-purple-50 focus:ring-1 focus:border-purple-500 focus:rounded-sm focus:ring-purple-500 focus:outline-none placeholder-purple-50"
                        type="text"
                        id="cityFilter1"
                        name="cityFilter1"
                        placeholder="Entrez une ville"
                />
            </div>
            <div class="flex flex-col items-center space-y-2 mr-6">
                <label class="policeperso text-red-50" for="dateFilter1">Date</label>
                <input class="w-28 bg-purple-800 bg-opacity-0 text-purple-50 focus:ring-1 focus:border-purple-500 focus:rounded-sm focus:ring-purple-500 focus:outline-none placeholder-purple-50"
                       type="date" max="2030-12-31" id="dateFilter1" name="dateFilter1"/>
            </div>
            <div class="flex flex-col items-center space-y-2">
                <label class="policeperso text-red-50" for="soireeFilter">Type de soirée</label>
                <select class="w-32 bg-purple-800 bg-opacity-0 text-purple-50 focus:ring-1 focus:border-purple-500 focus:bg-purple-400 focus:rounded-sm focus:ring-purple-500 focus:outline-none placeholder-purple-50"
                        id="soireeFilter" name="soireeFilter">
                    <option value="">Type de soirée</option>
                    <th:block th:each="type : ${uniqueEventTypes}">
                        <option th:value="${type}" th:text="${type}"></option>
                    </th:block>
                </select>
            </div>
            <input class="ml-8 bg-custom-color h-12 mt-3 w-24 rounded-sm text-purple-800 font-extrabold text-opacity-90 focus:ring-2 focus:border-purple-700 focus:ring-purple-500 focus:outline-none placeholder-purple-600"
                   type="submit" value="Filtrer"/>
        </div>
    </form>
</div>

<div class="container">

    <table>
        <tbody>
        <tr th:each="evenement, eventIndex : ${evenements}">
            <div th:if="${evenement.public_evenement==true}">
                <td>
                    <a th:href="'/eventz/evenement/details/' + ${evenement.idEvenement}"
                       class="hover:no-underline hover:text-red-100 ">
                        <div class="row align-items-center event-block no-gutters margin-40px-bottom hover:bg-gray-100 hover:bg-opacity-30"
                             th:attr="data-soiree=${evenement?.typeEvenement?.description_type_evenement},
    data-date=${evenement?.debut_evenement},
    data-ville=${(evenement?.adresse != null and evenement?.adresse?.ville_adresse != null and evenement?.adresse?.public_adresse) ? evenement?.adresse?.ville_adresse : ''}">
                            <div class="col-lg-5 col-sm-12 ">
                                <div class="position-relative">
                                    <img class="event-image"
                                         th:src="${evenement.hasPdp() ? '/eventz/evenement/image/' + evenement.idEvenement : 'https://www.bootdey.com/image/450x280/87CEFA/000000'}"
                                         alt="">
                                    <div class="events-date">
                                        <div class="font-size28">
                                            <p th:text="${evenement.debut_evenement.getDayOfMonth()}"></p>
                                        </div>
                                        <div class="font-size14">
                                            <th:block th:switch="${evenement.debut_evenement.getMonthValue()}">
                                                <p th:case="1">Jan</p>
                                                <p th:case="2">Fév</p>
                                                <p th:case="3">Mar</p>
                                                <p th:case="4">Avr</p>
                                                <p th:case="5">Mai</p>
                                                <p th:case="6">Juin</p>
                                                <p th:case="7">Juil</p>
                                                <p th:case="8">Août</p>
                                                <p th:case="9">Sept</p>
                                                <p th:case="10">Oct</p>
                                                <p th:case="11">Nov</p>
                                                <p th:case="12">Déc</p>
                                            </th:block>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 col-sm-12">
                                <div class="padding-60px-lr md-padding-50px-lr sm-padding-30px-all xs-padding-25px-all">
                                    <h2 class="policeperso text-red-50 text-5xl font-extrabold mb-8"
                                        th:text="${evenement.nom_evenement}"></h2>
                                    <ul class="event-time mb-2 mr-2">
                                        <li>
                                            <div class="flex items-center">
                                                <i class="icon-color far fa-clock mr-2 mt-1 w-5 h-5"></i>
                                                <p class="text-red-400 font-bold"
                                                   th:text="${evenement.debut_evenement}"></p>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="flex items-center">
                                                <i class="icon-color fas fa-user mr-2 mt-1 w-5 h-5"></i>
                                                <p class="text-red-400 font-bold"
                                                   th:text="${evenement.nb_place_evenement}"></p>
                                            </div>
                                        </li>
                                    </ul>
                                    <p class="text-red-50 font-bold" th:text="${evenement.description_evenement}"></p>
                                </div>
                            </div>
                        </div>
                    </a>
                </td>
            </div>

        </tr>
        </tbody>
    </table>
</div>

<div id="noResultsBlock" class="transition-block" style="display: none">
    <div class="content">
        <div class="text">
            <h2>Aucune soirée trouvée</h2>
            <p>
                Désolé, aucune soirée ne correspond aux critères de filtrage
                sélectionnés.
            </p>
        </div>
    </div>
</div>

<th:block th:insert="~{fragments/footer :: footer}"></th:block>


<script>
    window.addEventListener("load", function () {
        var filterForm = document.getElementById("filterForm1");
        if (filterForm) {
            filterForm.addEventListener("submit", function (event) {
                event.preventDefault(); // Empêche la soumission du formulaire par défaut

                const villeFilterInput = document.getElementById("cityFilter1");
                const dateFilterInput = document.getElementById("dateFilter1");
                const soireeFilterInput = document.getElementById("soireeFilter");

                const villeFilter = villeFilterInput.value.trim().toLowerCase();
                const dateFilter = dateFilterInput.value.trim();
                const soireeFilter = soireeFilterInput.value.trim();

                const transitionBlocks =
                    Array.from(document.querySelectorAll(".transition-block, .row.align-items-center.event-block.no-gutters.margin-40px-bottom")); // Rassemble tous les blocs dans une liste

                let anyResult = false; // Variable pour vérifier si au moins un bloc est trouvé

                transitionBlocks.forEach((block) => {
                    const ville = block.getAttribute("data-ville");
                    const dateString = block.getAttribute("data-date");
                    const soiree = block.getAttribute("data-soiree");

                    let villeMatch; // Déclarer la variable en dehors de la condition

                    if (ville !== null) {
                        // Si oui, appliquer la méthode toLowerCase()
                        const villeLowerCase = ville.toLowerCase();
                        villeMatch =
                            villeFilter === "" || villeLowerCase.includes(villeFilter);
                        // Utiliser la variable villeLowerCase dans les comparaisons
                    } else {
                        // Si non, considérer que le filtre sur la ville est toujours vérifié
                        villeMatch = true;
                    }

                    // Convertir la date string en objet JavaScript Date
                    const date = convertToDate(dateString);

                    const dateMatch = dateFilter === "" || isSameDate(date, new Date(dateFilter));
                    const soireeMatch = soireeFilter === "" || soiree === soireeFilter;

                    if (villeMatch && dateMatch && soireeMatch) {
                        block.style.display = "flex"; // Afficher le bloc s'il correspond aux filtres
                        anyResult = true; // Indiquer qu'au moins un bloc est trouvé
                    } else {
                        block.style.display = "none"; // Masquer le bloc s'il ne correspond pas aux filtres
                    }
                });

                // Afficher ou masquer le bloc "Aucune soirée trouvée" en fonction du résultat
                const noResultsBlock = document.getElementById("noResultsBlock");
                if (anyResult) {
                    noResultsBlock.style.display = "none"; // Masquer le bloc s'il y a des résultats
                } else {
                    noResultsBlock.style.display = "block"; // Afficher le bloc s'il n'y a pas de résultats
                }
            });
        }

        // Fonction pour convertir la date string en objet JavaScript Date
        function convertToDate(dateString) {
            const parts = dateString.split("-"); // Supposer que la date est au format "YYYY-MM-DD"
            const year = parseInt(parts[0]);
            const month = parseInt(parts[1]) - 1; // Les mois sont indexés à partir de 0 en JavaScript
            const day = parseInt(parts[2]);
            return new Date(year, month, day);
        }

        // Fonction pour vérifier si deux dates sont égales (sans tenir compte de l'heure)
        function isSameDate(date1, date2) {
            return date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate();
        }


        var transitionBlocks = document.querySelectorAll(".transition-block");
        transitionBlocks.forEach(function (transitionBlock) {
            transitionBlock.style.backgroundColor =
                "rgb(233, 186, 206)"; /* couleur rose */
        });
    });
    document.addEventListener("DOMContentLoaded", function () {
        // Fonction pour mettre à jour la valeur de l'input date avec la date actuelle
        function updateDateInput() {
            var currentDate = new Date().toISOString().slice(0, 10); // Récupérer la date actuelle au format YYYY-MM-DD
            var dateFilterInput = document.getElementById("dateFilter1"); // Récupérer l'input date
            dateFilterInput.value = currentDate; // Mettre à jour la valeur de l'input date avec la date actuelle
        }

        var sortirCeSoirLink = document.getElementById("sortirCeSoir");
        sortirCeSoirLink.addEventListener("click", function (event) {
            updateDateInput();
            event.preventDefault();
        });
    });

    class MessageBox {
        constructor(option) {
            this.option = option || {};
            this.msgBoxArea = document.getElementById('msgboxArea');
        }

        show(msg, callback, closeLabel) {
            if (closeLabel === undefined || closeLabel === null) {
                closeLabel = "Close";
            }

            const option = this.option;

            const msgboxBox = document.createElement("DIV");
            const msgboxContent = document.createElement("DIV");
            const msgboxCommand = document.createElement("DIV");
            const msgboxClose = document.createElement("A");

            msgboxContent.classList.add("msgbox-content");
            msgboxContent.innerText = msg;

            msgboxCommand.classList.add("msgbox-command");

            msgboxClose.classList.add("msgbox-close");
            msgboxClose.setAttribute("href", "#");
            msgboxClose.innerText = closeLabel;

            msgboxBox.classList.add("msgbox-box");
            msgboxBox.appendChild(msgboxContent);

            if (option.hideCloseButton === false || option.hideCloseButton === undefined) {
                msgboxCommand.appendChild(msgboxClose);
                msgboxBox.appendChild(msgboxCommand);
            }

            this.msgBoxArea.appendChild(msgboxBox);

            msgboxClose.onclick = (evt) => {
                evt.preventDefault();
                if (msgboxBox.classList.contains("msgbox-box-hide")) {
                    return;
                }
                clearTimeout(this.msgboxTimeout);
                this.msgboxTimeout = null;
                this.hide(msgboxBox, callback);
            };

            if (option.closeTime > 0) {
                this.msgboxTimeout = setTimeout(() => {
                    this.hide(msgboxBox, callback);
                }, option.closeTime);
            }
        }

        hideMessageBox(msgboxBox) {
            return new Promise(resolve => {
                msgboxBox.ontransitionend = () => {
                    resolve();
                };
            });
        }

        async hide(msgboxBox, callback) {
            if (msgboxBox !== null) {
                msgboxBox.classList.add("msgbox-box-hide");
            }
            await this.hideMessageBox(msgboxBox);
            this.msgBoxArea.removeChild(msgboxBox);
            clearTimeout(this.msgboxTimeout);
            if (typeof callback === "function") {
                callback();
            }
        }
    }

    const msgbox = new MessageBox({
        closeTime: 5000,
        hideCloseButton: false
    });


    // Show message box automatically when the page loads
    window.addEventListener('load', () => {
        const username = msgboxArea.getAttribute('data-username');
        msgbox.show("Hello, bienvenue " + username + " ça fait longtemps fdp ", null);
    });
</script>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript"></script>
</body>
</html>